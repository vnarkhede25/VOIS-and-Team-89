<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fall Detected</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container fall-alert-page">
        <!-- Alert Banner -->
        <div class="alert-banner">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="white">
                <path d="M20 4L4 36h32L20 4z" fill="white" opacity="0.9"/>
                <text x="20" y="28" text-anchor="middle" fill="#DC2626" font-size="20" font-weight="bold">!</text>
            </svg>
            <h1 class="alert-title">FALL DETECTED!</h1>
        </div>

        <!-- Main Content -->
        <div class="fall-alert-content">
            <h2 class="alert-heading">Sending alert in...</h2>
            <p class="alert-subheading">Please confirm your status.</p>

            <!-- Timer -->
            <div class="timer-container">
                <div class="timer-circle">
                    <div class="timer-number" id="timerDisplay">10</div>
                    <div class="timer-label">SECONDS</div>
                </div>
            </div>

            <!-- Info Message -->
            <div class="info-message">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="#6B7280">
                    <path d="M16 4C9.4 4 4 9.4 4 16s5.4 12 12 12 12-5.4 12-12S22.6 4 16 4zm2 18h-4v-8h4v8zm0-10h-4V8h4v4z"/>
                </svg>
                <p class="info-text">We are contacting your guardian automatically when the timer ends.</p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="alert-actions">
            <button class="alert-button primary-alert" onclick="requestHelpNow()">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="white">
                    <path d="M14 2v10M14 16v10M4 14h10M18 14h10M6 6l7 7M22 6l-7 7M6 22l7-7M22 22l-7-7" stroke="white" stroke-width="3" stroke-linecap="round"/>
                </svg>
                Need Help Now
            </button>
            
            <button class="alert-button safe-alert" onclick="confirmSafe()">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="currentColor">
                    <circle cx="14" cy="14" r="14" fill="currentColor"/>
                    <path d="M8 14l4 4 8-8" stroke="white" stroke-width="3" fill="none" stroke-linecap="round"/>
                </svg>
                I am Safe
            </button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Stop monitoring when on fallalert page
        if (fallCheckInterval) {
            clearInterval(fallCheckInterval);
        }
        
        // Notify guardian immediately when fall is detected
        async function notifyGuardianOfFall() {
            try {
                const payload = {
                    elderly_name: "User",
                    device_id: "belt_001",
                    location: "Home"
                }
                const response = await fetch("http://127.0.0.1:5000/notify-guardian-fall", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                })
                const data = await response.json()
                console.log("[GUARDIAN NOTIFICATION] Fall detected - Guardian notified:", data)
            } catch (error) {
                console.log("[GUARDIAN NOTIFICATION] Error notifying guardian:", error)
            }
        }
        
        // Notify guardian when page loads
        notifyGuardianOfFall()
        
        // Start countdown timer
        let timeLeft = 10;
        const timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timerDisplay').textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                contactGuardian();
            }
        }, 1000);
    </script>
</body>
</html>
